<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Temperatura – Poznań</title>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
    body { margin: 0; }
    #chart { width: 100vw; height: 100vh; }
</style>
</head>
<body>
<div id="chart"></div>

<script>
(async () => {
    // Obliczamy zakres dat: ostatnie 7 dni
    const end = new Date();
    const start = new Date();
    start.setDate(end.getDate() - 7);

    const fmt = d => d.toISOString().split("T")[0]; // yyyy-mm-dd

    const url = `https://meteostat.p.rapidapi.com/point/daily?lat=52.4069&lon=16.9252&start=${fmt(start)}&end=${fmt(end)}`;

    const response = await fetch(url, {
        method: "GET",
        headers: {
            "X-RapidAPI-Key": "47414c2109msh788a167e59cd183p1345a0jsna3e25e8c6c50",
            "X-RapidAPI-Host": "meteostat.p.rapidapi.com"
        }
    });

    const json = await response.json();
    const data = json.data;

    // Wyciągamy dane
    const dates = data.map(d => d.date);
    const tmin = data.map(d => d.tmin);
    const tmax = data.map(d => d.tmax);
    const tavg = data.map(d => d.tavg);

    // Wykres
    const trace1 = { x: dates, y: tmin, name: "Min", type: "scatter" };
    const trace2 = { x: dates, y: tavg, name: "Średnia", type: "scatter" };
    const trace3 = { x: dates, y: tmax, name: "Max", type: "scatter" };

    const layout = {
        title: "Temperatura – Poznań (ostatnie 7 dni)",
        margin: { t: 40, l: 40, r: 10, b: 30 }
    };

    Plotly.newPlot("chart", [trace1, trace2, trace3], layout, {responsive: true});
})();
</script>
</body>
</html>
